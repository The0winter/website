@echo off
:: 设置字符集为 UTF-8
chcp 65001 >nul

:: 进入项目根目录
cd /d "F:\Website\Test1"

echo ========================================================
echo [1/3] 正在启动本地更新 (run_update.js)...
echo 目标：扫描本地书籍 -> 对比网站 -> 抓取新章节
echo ========================================================
node run_update.js

echo.
echo.
echo ========================================================
echo [2/3] 正在同步到云端 (upload_to_vps.js)...
echo 目标：读取本地 JSON -> 上传 VPS -> 存入 MongoDB
echo ========================================================
node upload_to_vps.js

echo.
echo.
echo ========================================================
echo [3/3] 正在进行 SEO 推送 (Baidu Push)...
echo 目标：读取 Sitemap -> 筛选新链接 -> 推送给百度
echo ========================================================

:: ⚠️ 关键步骤：必须进入 server 目录，否则找不到 axios 包
cd server

:: 自动判断你保存的是 .js 还是 .cjs
if exist baidu_push.cjs (
    echo 检测到 .cjs 文件，正在运行...
    node baidu_push.cjs
) else (
    echo 正在运行 .js 文件...
    node baidu_push.js
)

:: 回到项目根目录（养成好习惯）
cd ..

echo.
echo ========================================================
echo 🎉 恭喜！更新、上传、SEO推送 全部完成！
echo ========================================================
pause